CREATE OR REPLACE
TYPE SYSTEM.DatosPersonales AS OBJECT(
  nombre VARCHAR2(100),
  tipo_documento VARCHAR2(15),
  id_documento VARCHAR2(10),
  STATIC FUNCTION validar_documento ( id_documento VARCHAR2, tipo_documento VARCHAR2 ) RETURN VARCHAR2,
  STATIC FUNCTION validar_nombre ( nombre VARCHAR2 ) RETURN VARCHAR2
);

CREATE OR REPLACE
TYPE SYSTEM.Costo AS OBJECT(
  monto INT,
  agregado INT,
  STATIC FUNCTION monto_total ( monto INT, agregado INT ) RETURN INT,
  STATIC FUNCTION convertir ( monto INT, agregado INT ) RETURN INT
);

CREATE OR REPLACE
TYPE SYSTEM.RangoFecha AS OBJECT(
  fecha_inicial DATE,
  fecha_final DATE,
  STATIC FUNCTION validar_fecha ( fecha DATE ) RETURN VARCHAR2,
  STATIC FUNCTION mover_fecha ( fecha DATE ) RETURN VARCHAR2
);

CREATE OR REPLACE
TYPE SYSTEM.Calificacion AS OBJECT(
  escala VARCHAR2(2),
  observaciones VARCHAR2(200),
  STATIC FUNCTION promedio RETURN VARCHAR2,
  STATIC FUNCTION validar_escala ( escala VARCHAR2 ) RETURN VARCHAR2
);

DROP TABLE SYSTEM.CONTINGENCIA;
CREATE TABLE SYSTEM.CONTINGENCIA (
  id INT PRIMARY KEY NOT NULL,
  nombre VARCHAR2(100) NOT NULL,
  descripcion VARCHAR2(100) NOT NULL
);
SELECT * FROM SYSTEM.CONTINGENCIA;

DROP TABLE SYSTEM.RUTA;
CREATE TABLE SYSTEM.RUTA (
  id INT PRIMARY KEY NOT NULL,
  nombre VARCHAR2(100) NOT NULL,
  contingencia_id INT,
  FOREIGN KEY (contingencia_id)
    REFERENCES Contingencia(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.RUTA;

DROP TABLE SYSTEM.UNIDAD;
CREATE TABLE SYSTEM.UNIDAD (
  id INT PRIMARY KEY NOT NULL,
  ruta_id INT,
  fecha RangoFecha NOT NULL,
  placa VARCHAR2(10) NOT NULL,
  foto BLOB NOT NULL,
  tipo VARCHAR2(100) NOT NULL,
  estado VARCHAR2(100) NOT NULL,
  ubicacion VARCHAR2(100) NOT NULL,
  numero_asientos INT DEFAULT 0,
  FOREIGN KEY (ruta_id)
    REFERENCES Ruta(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.UNIDAD;

DROP TABLE SYSTEM.ALIANZA;
CREATE TABLE SYSTEM.ALIANZA (
  id INT PRIMARY KEY NOT NULL,
  nombre VARCHAR2(100) NOT NULL,
  fecha RangoFecha NOT NULL,
  descripcion VARCHAR2(100) NOT NULL
);
SELECT * FROM SYSTEM.ALIANZA;

DROP TABLE SYSTEM.DISPONE;
CREATE TABLE SYSTEM.DISPONE (
  id INT PRIMARY KEY NOT NULL,
  fecha RangoFecha NOT NULL,
  alianza_id INT NOT NULL,
  unidad_id INT NOT NULL,
  FOREIGN KEY (alianza_id)
    REFERENCES Alianza(id)
    ON DELETE CASCADE,
  FOREIGN KEY (unidad_id)
    REFERENCES Unidad(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.DISPONE;

DROP TABLE SYSTEM.MANTENIMIENTO;
CREATE TABLE SYSTEM.MANTENIMIENTO(
  id INT PRIMARY KEY NOT NULL,
  unidad_id INT NOT NULL,
  observaciones VARCHAR2(100) NOT NULL,
  fecha RangoFecha NOT NULL,
  repuestos VARCHAR2(100),
  desperfectos VARCHAR2(100),
  FOREIGN KEY (unidad_id)
    REFERENCES Unidad(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.MANTENIMIENTO;

DROP TABLE SYSTEM.PED;
CREATE TABLE SYSTEM.PED (
  id INT PRIMARY KEY NOT NULL,
  nombre VARCHAR2(100) NOT NULL,
  tipo INT NOT NULL,
  coordenadas VARCHAR2(100) NOT NULL
);
SELECT * FROM SYSTEM.PED;

DROP TABLE SYSTEM.CLIENTE;
CREATE TABLE SYSTEM.CLIENTE (
  id INT PRIMARY KEY NOT NULL,
  datos DatosPersonales NOT NULL,
  fecha_desde DATE DEFAULT SYSDATE,
  tipo VARCHAR2(100) NOT NULL,
  logo BLOB,
  genero VARCHAR2(100),
  telefono VARCHAR2(20)
);
SELECT * FROM SYSTEM.CLIENTE;

DROP TABLE SYSTEM.RESERVA;
CREATE TABLE SYSTEM.RESERVA (
  id INT PRIMARY KEY NOT NULL,
  estado VARCHAR2(100) NOT NULL,
  hora_traslado DATE NOT NULL,
  costo Costo NOT NULL,
  calificacion Calificacion NOT NULL,
  fechas RangoFecha NOT NULL,
  duracion INT NOT NULL,
  puestos INT DEFAULT 1,
  embarque INT NOT NULL,
  desembarque INT NOT NULL,
  unidad_id INT NOT NULL,
  cliente_id INT NOT NULL,
  FOREIGN KEY (unidad_id)
    REFERENCES Unidad(id)
    ON DELETE CASCADE,
  FOREIGN KEY (embarque)
    REFERENCES PED(id)
    ON DELETE CASCADE,
  FOREIGN KEY (desembarque)
    REFERENCES PED(id)
    ON DELETE CASCADE,
  FOREIGN KEY (cliente_id)
    REFERENCES Cliente(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.RESERVA;

DROP TABLE SYSTEM.HORARIO;
CREATE TABLE SYSTEM.HORARIO (
  id INT PRIMARY KEY NOT NULL,
  hora_inicio DATE NOT NULL,
  hora_fin DATE NOT NULL,
  dia VARCHAR2(100) NOT NULL
);
SELECT * FROM SYSTEM.HORARIO;

DROP TABLE SYSTEM.CUMPLE;
CREATE TABLE SYSTEM.CUMPLE(
  id INT PRIMARY KEY NOT NULL,
  horario_id INT NOT NULL,
  unidad_id INT NOT NULL,
  FOREIGN KEY (horario_id)
    REFERENCES Horario(id)
    ON DELETE CASCADE,
  FOREIGN KEY (unidad_id)
    REFERENCES Unidad(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.CUMPLE;

DROP TABLE SYSTEM.RECORRE;
CREATE TABLE SYSTEM.RECORRE (
  id INT PRIMARY KEY NOT NULL,
  ruta_id INT NOT NULL,
  pos INT NOT NULL,
  punto INT NOT NULL,
  FOREIGN KEY (ruta_id)
    REFERENCES Ruta(id)
    ON DELETE CASCADE,
  FOREIGN KEY (punto)
    REFERENCES PED(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.RECORRE;

DROP TABLE SYSTEM.SERVICIOS;
CREATE TABLE SYSTEM.SERVICIOS (
  id INT PRIMARY KEY NOT NULL,
  nombre VARCHAR2(100) NOT NULL,
  descripcion VARCHAR2(100) NOT NULL,
  exclusivo INT NOT NULL
);
SELECT * FROM SYSTEM.SERVICIOS;

DROP TABLE SYSTEM.OFRECE;
CREATE TABLE SYSTEM.OFRECE (
  id INT PRIMARY KEY NOT NULL,
  servicios_id INT NOT NULL,
  unidad_id INT NOT NULL,
  FOREIGN KEY (servicios_id)
    REFERENCES Servicios(id)
    ON DELETE CASCADE,
  FOREIGN KEY (unidad_id)
    REFERENCES Unidad(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.OFRECE;

DROP TABLE SYSTEM.CATEGORIA;
CREATE TABLE SYSTEM.CATEGORIA(
  id INT PRIMARY KEY NOT NULL,
  nommbre VARCHAR2(100) NOT NULL,
  foto BLOB
);
SELECT * FROM SYSTEM.CATEGORIA;

DROP TABLE SYSTEM.PLAN;
CREATE TABLE SYSTEM.PLAN(
  id INT PRIMARY KEY NOT NULL,
  tipo_cliente VARCHAR2(100) NOT NULL,
  tipo_unidad VARCHAR2(100) NOT NULL,
  nombre VARCHAR2(100) NOT NULL,
  caracteristicas VARCHAR2(100) NOT NULL,
  fecha RangoFecha NOT NULL,
  categoria_id INT NOT NULL,
  FOREIGN KEY (categoria_id)
    REFERENCES Categoria(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.PLAN;

DROP TABLE SYSTEM.SYSTEM.CONTRATA;
CREATE TABLE SYSTEM.CONTRATA(
  id INT PRIMARY KEY NOT NULL,
  fecha RangoFecha NOT NULL,
  activo VARCHAR2(2) NOT NULL,
  plan_id INT NOT NULL,
  cliente_id INT NOT NULL,
  FOREIGN KEY (plan_id)
    REFERENCES Plan(id)
    ON DELETE CASCADE,
  FOREIGN KEY (cliente_id)
    REFERENCES Cliente(id)
    ON DELETE CASCADE
);
SELECT * FROM SYSTEM.CONTRATA;
